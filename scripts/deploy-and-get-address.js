// scripts/deploy-and-get-address.js
// Deploy contract and get address

console.log('ðŸš€ FLOWSUBS DEPLOYMENT - GET YOUR ADDRESS');
console.log('==========================================');
console.log('');
console.log('ðŸ“‹ STEP-BY-STEP DEPLOYMENT:');
console.log('');
console.log('1. Go to: https://testnet.flowport.io/');
console.log('');
console.log('2. Connect with private key:');
console.log('   b9098df8816abc841a95eda6214e6cc95e6f4cf38bee0494e2e89fd36226efaf');
console.log('');
console.log('3. Execute this transaction to get your account address:');
console.log('');
console.log('```cadence');
console.log('transaction {');
console.log('  prepare(signer: AuthAccount) {');
console.log('    log("YOUR_ACCOUNT_ADDRESS: ".concat(signer.address.toString()))');
console.log('  }');
console.log('}');
console.log('```');
console.log('');
console.log('4. Copy the address from the logs (it will look like: 0x1234567890abcdef...)');
console.log('');
console.log('5. Now deploy the contract with this transaction:');
console.log('');
console.log('```cadence');
console.log('transaction {');
console.log('    prepare(signer: AuthAccount) {');
console.log('        let contractCode = `');
console.log('pub contract FlowSubs {');
console.log('    pub var subscriptionCounter: UInt64');
console.log('    pub var subscriptions: {UInt64: Subscription}');
console.log('    pub var providers: {Address: ProviderInfo}');
console.log('');
console.log('    pub struct Subscription {');
console.log('        pub let id: UInt64');
console.log('        pub let subscriber: Address');
console.log('        pub let provider: Address');
console.log('        pub let amount: UFix64');
console.log('        pub let interval: UFix64');
console.log('        pub let nextPaymentTime: UFix64');
console.log('        pub let isActive: Bool');
console.log('        pub let createdAt: UFix64');
console.log('');
console.log('        init(id: UInt64, subscriber: Address, provider: Address, amount: UFix64, interval: UFix64, nextPaymentTime: UFix64, isActive: Bool, createdAt: UFix64) {');
console.log('            self.id = id');
console.log('            self.subscriber = subscriber');
console.log('            self.provider = provider');
console.log('            self.amount = amount');
console.log('            self.interval = interval');
console.log('            self.nextPaymentTime = nextPaymentTime');
console.log('            self.isActive = isActive');
console.log('            self.createdAt = createdAt');
console.log('        }');
console.log('    }');
console.log('');
console.log('    pub struct ProviderInfo {');
console.log('        pub let address: Address');
console.log('        pub let name: String');
console.log('        pub let description: String');
console.log('        pub let isActive: Bool');
console.log('');
console.log('        init(address: Address, name: String, description: String, isActive: Bool) {');
console.log('            self.address = address');
console.log('            self.name = name');
console.log('            self.description = description');
console.log('            self.isActive = isActive');
console.log('        }');
console.log('    }');
console.log('');
console.log('    init() {');
console.log('        self.subscriptionCounter = 0');
console.log('        self.subscriptions = {}');
console.log('        self.providers = {}');
console.log('    }');
console.log('');
console.log('    pub fun createSubscription(subscriber: Address, provider: Address, amount: UFix64, interval: UFix64): UInt64 {');
console.log('        let subscriptionId = self.subscriptionCounter + 1');
console.log('        self.subscriptionCounter = subscriptionId');
console.log('');
console.log('        let subscription = Subscription(');
console.log('            id: subscriptionId,');
console.log('            subscriber: subscriber,');
console.log('            provider: provider,');
console.log('            amount: amount,');
console.log('            interval: interval,');
console.log('            nextPaymentTime: getCurrentBlock().timestamp + interval,');
console.log('            isActive: true,');
console.log('            createdAt: getCurrentBlock().timestamp');
console.log('        )');
console.log('');
console.log('        self.subscriptions[subscriptionId] = subscription');
console.log('        return subscriptionId');
console.log('    }');
console.log('');
console.log('    pub fun cancelSubscription(subscriptionId: UInt64) {');
console.log('        if let subscription = self.subscriptions[subscriptionId] {');
console.log('            let cancelledSubscription = Subscription(');
console.log('                id: subscription.id,');
console.log('                subscriber: subscription.subscriber,');
console.log('                provider: subscription.provider,');
console.log('                amount: subscription.amount,');
console.log('                interval: subscription.interval,');
console.log('                nextPaymentTime: subscription.nextPaymentTime,');
console.log('                isActive: false,');
console.log('                createdAt: subscription.createdAt');
console.log('            )');
console.log('');
console.log('            self.subscriptions[subscriptionId] = cancelledSubscription');
console.log('        }');
console.log('    }');
console.log('');
console.log('    pub fun registerProvider(name: String, description: String) {');
console.log('        let providerInfo = ProviderInfo(');
console.log('            address: self.account.address,');
console.log('            name: name,');
console.log('            description: description,');
console.log('            isActive: true');
console.log('        )');
console.log('');
console.log('        self.providers[self.account.address] = providerInfo');
console.log('    }');
console.log('');
console.log('    pub fun getSubscription(subscriptionId: UInt64): Subscription? {');
console.log('        return self.subscriptions[subscriptionId]');
console.log('    }');
console.log('');
console.log('    pub fun getSubscriberSubscriptions(subscriber: Address): [Subscription] {');
console.log('        var subscriberSubscriptions: [Subscription] = []');
console.log('        for subscription in self.subscriptions.values {');
console.log('            if subscription.subscriber == subscriber {');
console.log('                subscriberSubscriptions.append(subscription)');
console.log('            }');
console.log('        }');
console.log('        return subscriberSubscriptions');
console.log('    }');
console.log('');
console.log('    pub fun getAllProviders(): [ProviderInfo] {');
console.log('        var allProviders: [ProviderInfo] = []');
console.log('        for provider in self.providers.values {');
console.log('            allProviders.append(provider)');
console.log('        }');
console.log('        return allProviders');
console.log('    }');
console.log('}');
console.log('`');
console.log('');
console.log('        let contract = Contract(name: "FlowSubs", code: contractCode)');
console.log('        signer.contracts.add(name: "FlowSubs", code: contract.code)');
console.log('');
console.log('        log("CONTRACT_DEPLOYED_SUCCESSFULLY!")');
console.log('        log("CONTRACT_ADDRESS: ".concat(signer.address.toString()))');
console.log('    }');
console.log('}');
console.log('```');
console.log('');
console.log('6. After deployment, you will see logs like:');
console.log('   CONTRACT_DEPLOYED_SUCCESSFULLY!');
console.log('   CONTRACT_ADDRESS: 0x1234567890abcdef...');
console.log('');
console.log('7. Copy the CONTRACT_ADDRESS and tell me what it is!');
console.log('');
console.log('ðŸŽ¯ YOUR CONTRACT ADDRESS WILL BE THE SAME AS YOUR ACCOUNT ADDRESS');
console.log('   (The address where you deploy the contract becomes the contract address)');
console.log('');
console.log('ðŸ“ž Once you have the address, just tell me: "My contract address is 0x..."');
console.log('   and I will update your configuration immediately!');
